{"version":3,"sources":["restZook.js"],"names":[],"mappings":"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","file":"restZook-compiled.js","sourcesContent":["/**\n * for dubbo rest\n */\n'use strict';\n\nvar net = require('net');\nvar debug = require('debug');\nvar error = debug('zoodubbo:error');\nvar request = require('request');\n/////////////////////////////\n// require core modules\nvar url = require('url');\nvar querystring = require('querystring');\nvar zookeeper = require('node-zookeeper-client');\n\n\n/**\n * Constructor of ZD.\n * @param {Object} conf\n * {\n *  version: String // dubbo version information\n *  connection: String, // zookeeper address\n *  sessionTimeout: Number, // Session timeout in milliseconds, defaults to 30 seconds.\n *  spinDelay: Number, // The delay (in milliseconds) between each connection attempts.\n *  retries: Number // The number of retry attempts for connection loss exception.\n * }\n * @returns {ZD}\n * @constructor\n */\nfunction ZD(conf) {\n    if (!(this instanceof ZD)) return new ZD(conf);\n    conf = conf || {};\n    this._version = conf.version;\n    this._connection = conf.connection;\n    this._client = this.client = zookeeper.createClient(this._connection, {\n        sessionTimeout: conf.sessionTimeout,\n        spinDelay: conf.spinDelay,\n        retries: conf.retries\n    });\n    this._cache = this.cache = {};\n}\n\nZD.prototype.connect = function () {\n    if (!this._client || !this._client.connect) {\n        return;\n    }\n    this._client.connect();\n};\nZD.prototype.close = function () {\n    if (!this._client || !this._client.close) {\n        return;\n    }\n    this._client.close();\n};\n\n/**\n * Get a invoker.\n * @param {String} path e.g. com.woqu.user.UserService\n * @param {Object} [opt] e.g. {version: String,timeout: Number}\n * @returns {Invoker}\n * @public\n */\nZD.prototype.getInvoker = function (path, opt) {\n    opt = opt || {};\n    return new Invoker(this, {\n        path: path,\n        timeout: opt.timeout,\n        version: (opt.version || '0.0.0').toUpperCase()\n    });\n};\n\n/**\n * Get a provider from the registry.\n *\n * @param {String} path\n * @param {String} version\n * @param {Function} cb\n * @returns {*}\n * @public\n */\nZD.prototype.getProvider = function (path, version, cb) {\n    var self = this;\n    var _path = '/dubbo/' + path + '/providers';\n    return self._client.getChildren(_path, function (err, children) {\n        /**\n         *  children example:\n         * [dubbo://192.168.5.126:27123/com.woqu.visa.v2.product.service.VisaProductInfoService?anyhost=true&application=visa_service\n         * &default.service.filter=default&dubbo=2.8.4&generic=false&interface=com.woqu.visa.v2.product.service.VisaProductInfoService\n         * &methods=queryProductByCode,addProduct,updateProductState,queryProductById,queryProductByConditon,delProduct,updateProductSaleChannel,\n         * updateProductBase,copyProduct&pid=14004&side=provider&threadpool=cached&threads=20&timestamp=1496903941757,\n         * rest://192.168.5.126:30003/visa/v2/com.woqu.visa.v2.product.service.VisaProductInfoService?anyhost=true&application=visa_service\n         * &default.service.filter=default&dubbo=2.8.4&generic=false&interface=com.woqu.visa.v2.product.service.VisaProductInfoService\n         * &methods=queryProductByCode,addProduct,updateProductState,queryProductById,queryProductByConditon,delProduct,updateProductSaleChannel,\n         * updateProductBase,copyProduct&pid=14004&server=tomcat&side=provider&timestamp=1496903940799]\n         */\n        var query, parsed, provider, i, l;\n        if (err) {\n            return cb(err);\n        }\n        if (children && !children.length) {\n            return cb('Can\\'t find children from the node: ' + _path + ' ,please check the path!');\n        }\n        //console.log('===================get dubbo providers:', children);\n        try {\n            for (i = 0, l = children.length; i < l; i++) {\n                parsed = url.parse(decodeURIComponent(children[i]));\n                if (parsed.protocol === 'rest:') {\n                    query = querystring.parse(parsed.query);\n                    break;\n                }\n            }\n            //console.log('=========parsed json:',parsed);\n            provider = {\n                host: parsed.host,\n                methods:{} //e.g.{\"methodA\":\"GET:/product/query/{id}\",\"methodB\":\"POST:/product/edit\"}\n            };\n            var pathname_arr = parsed.pathname.split(\"/\");///visa/v2/com.woqu.visa.v2.product.service.VisaProductInfoService\n            var pathStr = \"\", interfaceStr = \"\", len = pathname_arr.length;\n            pathname_arr.forEach(function(a,idx){\n                if(a && idx != len-1){\n                    pathStr += '/' + a;\n                }else if(a && idx == len-1){\n                    interfaceStr = a;\n                }\n            });\n            provider.host = 'http://' + provider.host + pathStr;\n            var req_url = provider.host + '/path/get-path/' + interfaceStr;\n            //从这个约束好的路径请求获取所有接口的path和参数信息\n            console.log('=========request service path :',req_url);\n            request.get({url:req_url,contentType:'application/json'}, function(err, rsp, crs){\n                if(err){\n                    console.log('===find path of service error',err);\n                }\n                console.log('===find path of service success' , crs);\n                if(rsp.headers['content-type'].indexOf('application/json') > -1) crs = JSON.parse(crs);\n                if(crs.rs != 1){\n                    return cb(\"inner service exception, cannot get paths\");\n                }else{\n                    provider.methods = crs.data;\n                    self._cache[path] = provider;\n                    return cb(false, provider);\n                }\n            })\n        } catch (err) {\n            return cb(err);\n        }\n    });\n};\n\n/**\n * Expose `Invoker`.\n *\n * @type {Invoker}\n */\n/**\n * Constructor of Invoker.\n *\n * @param {ZD} zd\n * @param {Object} opt\n * {\n *  path: String // The path of service node.\n *  version: String, // The version of service.\n *  timeout: Number, // Timeout in milliseconds, defaults to 60 seconds.\n * }\n * @returns {Invoker}\n * @constructor\n */\nfunction Invoker(zd, opt) {\n    if (!(this instanceof Invoker)) return new Invoker(zd, opt);\n    this._zd = zd;\n    opt = opt || {};\n    this._path = opt.path;\n    this._version = opt.version;\n    this._timeout = (opt.timeout || '60000') + '';\n\n    this._attchments = {\n        $class: 'java.util.HashMap',\n        $: {\n            'path': this._path,\n            'interface': this._path,\n            'timeout': this._timeout,\n            'version': this._version\n        }\n    };\n}\n/**\n * Excute the method\n *\n * @param {String} method\n * @param {Array} args\n * @param {Function} [cb]\n * @public\n */\nInvoker.prototype.excute = function (method, args, cb) {\n    var self = this;\n    if (typeof cb !== 'function') {\n        return new Promise(function (resolve, reject) {\n            try {\n                self._excute(method, args, function (err, data) {\n                    if (err) {\n                        return reject(err);\n                    }\n                    return resolve(data);\n                });\n            } catch (err) {\n                return reject(err);\n            }\n        });\n    } else {\n        try {\n            return self._excute(method, args, cb);\n        } catch (err) {\n            return cb(err);\n        }\n    }\n};\n\n/**\n * Excute the method.\n * @param {String} method\n * @param {Map} args {name:'tom',id:123}\n * @param {Function} cb\n * @private\n */\nInvoker.prototype._excute = function (method, args, cb) {\n    var self = this;\n    var fromCache = true;\n    var tryConnectZoo = true;\n    var _provider = self._zd.cache[self._path];\n    if (_provider) {\n        return httpFetch(false, _provider);\n    } else {\n        fromCache = false;\n        return self._zd.getProvider(self._path, self._version, httpFetch);\n    } \n    function httpFetch(err, provider) {\n        if (err) {\n            return cb(err);\n        }\n        if (!~provider.methods[method]) {\n            if(fromCache){\n                return handleReconnect();\n            }else{\n                return cb('Can\\'t find the method:' + method + ', please check it!');\n            }\n        }\n        //http request data\n        var method_url = provider.methods[method].split(':');\n        if(method_url[0].toUpperCase().indexOf(\"POST-JSON\") != -1){\n            var real_url = provider.host + method_url[1] + '?a=1';\n            for(var k in args){\n                if(real_url.indexOf('{' + k + '}') > -1) real_url = real_url.replace('{' + k + '}',args[k]);\n            }\n            console.log('=============post json to dubbo rest service, url: ' + real_url + ',json:', args);\n            request.post({url:real_url,json:args}, function(err, rsp, body){\n                if(err){\n                    console.log('=====invoke rest service post error:', err);\n                    cb(err);\n                }else{\n                    cb(false, body);\n                }\n            });\n        }else if(method_url[0].toUpperCase().indexOf(\"POST-FORM\") != -1){\n            var real_url = provider.host + method_url[1] + '?a=1';\n            for(var k in args){\n                if(real_url.indexOf('{' + k + '}') > -1) real_url = real_url.replace('{' + k + '}',args[k]);\n            }\n            console.log('=============post form to dubbo rest service, url: ' + real_url + ',form:', args);\n            request.post({url:real_url,form:args}, function(err, rsp, body){\n                if(err){\n                    console.log('=====invoke rest service post error:', err);\n                    cb(err);\n                }else{\n                    cb(false, body);\n                }\n            });\n        }else{\n            var real_url = provider.host + method_url[1] + '?a=1';\n            for(var k in args){\n                if(real_url.indexOf('{' + k + '}') > -1) real_url = real_url.replace('{' + k + '}',args[k]);\n                else real_url += '&' + k + '=' + encodeURIComponent(args[k]);\n            }\n            console.log('=============get from dubbo rest service, url: ' + real_url);\n            request.get(real_url, function (error, response, body) {\n                if(error){\n                    console.log('=====invoke rest service get error:', error);\n                    cb(error);\n                }else{\n                    cb(false, body);\n                }\n            });\n        }\n    }\n    function handleReconnect() {\n        tryConnectZoo = true;\n        fromCache = false;\n        return self._zd.getProvider(self._path, self._version, httpFetch);\n    }\n};\n\nvar zd = new ZD({\n    connection: 'inner.dubbo1.woqu.com:2188,inner.dubbo2.woqu.com:2188,inner.dubbo3.woqu.com:2188',\n    version: '2.8.4'\n});\nzd.client.on('connected', function(rsp) {\n    console.log('zookeeper client (for rest protocol) connected!');\n});\n// connect to zookeeper\nzd.connect();\n\nmodule.exports = zd;"]}